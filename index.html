<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîÆ Numerus</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-image: url('background.png');
            background-size: cover;
            color: white;
            text-align: center;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }
        input, select, button {
            padding: 10px;
            margin: 5px;
            width: 100%;
        }
        .result {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* M·∫∑c ƒë·ªãnh PC: 3 c·ªôt */
            gap: 10px;
            margin-top: 20px;
            padding: 10px;
            background: transparent;
            border-radius: 10px;
        }

        .result-item {
            padding: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }

        /* Mobile: 4-5 c·ªôt khi m√†n h√¨nh nh·ªè */
        @media (max-width: 768px) {
            .result {
                grid-template-columns: repeat(4, 1fr); /* 4 c·ªôt cho mobile */
            }
        }

        /* ƒêi·ªán tho·∫°i nh·ªè h∆°n: 2-3 c·ªôt */
        @media (max-width: 480px) {
            .result {
                grid-template-columns: repeat(2, 1fr); /* 2 c·ªôt cho ƒëi·ªán tho·∫°i nh·ªè */
            }
        }

        .current-date-container {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            margin-top: 10px;
        }
        .current-date-container select {
            flex: 1;
            min-width: 100px;
            padding: 10px;
            border-radius: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Numerology Calculator</h1>
        <input type="text" id="name" placeholder="Nh·∫≠p h·ªç t√™n">
        <h2 style="font-size: 20px;">Nh·∫≠p ng√†y/th√°ng/nƒÉm sinh</h2>
        <div class="current-date-container">
            <select id="birthDay"></select>
            <select id="birthMonth"></select>
            <select id="birthYear"></select>
        </div>
        <h3 style="font-size: 20px;">Nh·∫≠p ng√†y/th√°ng/nƒÉm hi·ªán t·∫°i</h3>
        <div class="current-date-container">
            <select id="currentYear"></select>
            <select id="currentMonth"></select>
            <select id="currentDay"></select>
        </div>
        <button onclick="calculateNumerology()">T√≠nh to√°n</button>
        <div class="result" id="result"></div>
    </div>

    <script>
        function removeDiacritics(str) {
            return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        }
        function populateDateFields() {
            const yearSelect = document.getElementById('currentYear');
            const monthSelect = document.getElementById('currentMonth');
            const daySelect = document.getElementById('currentDay');
            const currentYear = new Date().getFullYear();

            for (let y = 2000; y <= currentYear + 10; y++) {
                yearSelect.innerHTML += `<option value="${y}">${y}</option>`;
            }

            for (let m = 1; m <= 12; m++) {
                monthSelect.innerHTML += `<option value="${m}">${m}</option>`;
            }

            for (let d = 1; d <= 31; d++) {
                daySelect.innerHTML += `<option value="${d}">${d}</option>`;
            }

            yearSelect.value = currentYear;
            monthSelect.value = new Date().getMonth() + 1;
            daySelect.value = new Date().getDate();
        }

        function populateBirthDateFields() {
            const birthYearSelect = document.getElementById('birthYear');
            const birthMonthSelect = document.getElementById('birthMonth');
            const birthDaySelect = document.getElementById('birthDay');
            const currentYear = new Date().getFullYear();

            for (let y = 1900; y <= currentYear; y++) {
                birthYearSelect.innerHTML += `<option value="${y}">${y}</option>`;
            }

            for (let m = 1; m <= 12; m++) {
                birthMonthSelect.innerHTML += `<option value="${m}">${m}</option>`;
            }

            updateDays(birthMonthSelect.value, birthYearSelect.value);

            birthMonthSelect.addEventListener('change', () => updateDays(birthMonthSelect.value, birthYearSelect.value));
            birthYearSelect.addEventListener('change', () => updateDays(birthMonthSelect.value, birthYearSelect.value));

            birthYearSelect.value = currentYear - 20;
            birthMonthSelect.value = 1;
            birthDaySelect.value = 1;
        }

        function updateDays(month, year) {
            const birthDaySelect = document.getElementById('birthDay');
            birthDaySelect.innerHTML = '';
            const daysInMonth = new Date(year, month, 0).getDate();
            for (let d = 1; d <= daysInMonth; d++) {
                birthDaySelect.innerHTML += `<option value="${d}">${d}</option>`;
            }
        }

        function reduceNumber(n) {
            while (n >= 10 && ![11, 22, 33].includes(n)) {
                n = n.toString().split('').reduce((sum, digit) => sum + parseInt(digit), 0);
            }
            return n;
        }

        function customReduceNumber(n) {
            if ([11, 22, 33].includes(n)) return n;
            while (n >= 10) {
                n = n.toString().split('').reduce((sum, digit) => sum + parseInt(digit), 0);
                if ([11, 22, 33].includes(n)) return n;
            }
            return n;
        }

        function changReduceNumber(n) {
            while (n >= 10) {
                n = n.toString().split('').reduce((sum, digit) => sum + parseInt(digit), 0);
            }
            return n;
        }

        const letterValues = {
            'a': 1, 'b': 2, 'c': 3, 'd': 4, 'e': 5, 'f': 6, 'g': 7, 'h': 8, 'i': 9,
            'j': 1, 'k': 2, 'l': 3, 'm': 4, 'n': 5, 'o': 6, 'p': 7, 'q': 8, 'r': 9,
            's': 1, 't': 2, 'u': 3, 'v': 4, 'w': 5, 'x': 6, 'y': 7, 'z': 8
        };
        function findMostFrequentNumber(name) {
            const counts = {};
            const numbers = name.toLowerCase().split('').map(char => letterValues[char] || 0);

            for (const num of numbers) {
                if (num > 0) {
                    counts[num] = (counts[num] || 0) + 1;
                }
            }

            let maxCount = 0;
            let mostFrequent = null;
            for (const [num, count] of Object.entries(counts)) {
                if (count > maxCount) {
                    maxCount = count;
                    mostFrequent = parseInt(num);
                }
            }

            return mostFrequent;
        }


        function calculateNameValue(name) {
            const nameParts = name.toLowerCase().normalize("NFD").replace(/[ÃÄ-ÕØ]/g, "").split(" ");
            let soulValue = 0, personalityValue = 0;
            const vowels = "aeiou";

            const reducedSums = [];
            const firstLetterValues = [];

            for (const part of nameParts) {
                let totalSum = 0;
                for (const char of part) {
                    const value = letterValues[char] || 0;
                    totalSum += value;
                    if (vowels.includes(char)) {
                        soulValue += value;
                    } else {
                        personalityValue += value;
                    }
                }
                reducedSums.push(reduceNumber(totalSum));
                if (part.length > 0) {
                    firstLetterValues.push(letterValues[part[0]] || 0);
                }
            }

            const balanceValue = reduceNumber(firstLetterValues.reduce((a, b) => a + b, 0));
            const finalSum = reduceNumber(reducedSums.reduce((a, b) => a + b, 0));
            const lastNameValue = nameParts.length > 0 ? reduceNumber(nameParts[nameParts.length - 1].split('').reduce((sum, char) => sum + (letterValues[char] || 0), 0)) : 0;

            return { 
                reducedSums, 
                finalSum, 
                soulValue: reduceNumber(soulValue), 
                personalityValue: reduceNumber(personalityValue), 
                balanceValue,
                lastNameValue
            };
        }

        function calculateChallenges(day, month, year) {
            const challenge1 = Math.abs(reduceNumber(day) - reduceNumber(month));
            const challenge2 = Math.abs(reduceNumber(day) - reduceNumber(year));
            const challenge3 = Math.abs(challenge1 - challenge2);
            const challenge4 = Math.abs(reduceNumber(month) - reduceNumber(year));
            return { challenge1, challenge2, challenge3, challenge4 };
        }

        function calculateChang(day, month, year) {
            const chang1 = changReduceNumber(day + month);
            const chang2 = changReduceNumber(day + year);
            const chang3 = changReduceNumber(chang1 + chang2);
            const chang4 = changReduceNumber(month + year);
            return { chang1, chang2, chang3, chang4 };
        }

        function calculateNumerology() {
            const name = removeDiacritics(document.getElementById('name').value);
            const day = parseInt(document.getElementById('birthDay').value);
            const month = parseInt(document.getElementById('birthMonth').value);
            const year = parseInt(document.getElementById('birthYear').value);
            const currentYear = parseInt(document.getElementById('currentYear').value);
            const currentMonth = parseInt(document.getElementById('currentMonth').value);

            const { reducedSums, finalSum, soulValue, personalityValue, balanceValue, lastNameValue } = calculateNameValue(name);

            const dayValue = reduceNumber(day);
            const birthValue = reduceNumber(day + month + year);
            const maturityValue = reduceNumber(birthValue + finalSum);
            const linkValue = reduceNumber(Math.abs(birthValue - finalSum));
            const personalYear = reduceNumber(dayValue + month + currentYear);
            const personalMonth = reduceNumber(personalYear + currentMonth);

            const { challenge1, challenge2, challenge3, challenge4 } = calculateChallenges(day, month, year);
            const { chang1, chang2, chang3, chang4 } = calculateChang(day, month, year);

            const missingNumbers = Array.from({ length: 9 }, (_, i) => i + 1).filter(num => !name.toLowerCase().split('').map(char => letterValues[char] || 0).includes(num));
            const passion = findMostFrequentNumber(name);
            const logicalMind = reduceNumber(lastNameValue + dayValue);

            const results = [
                { label: 'ƒê∆∞·ªùng ƒë·ªùi', value: maturityValue },
                { label: 'C√¢n b·∫±ng', value: balanceValue },
                { label: 'S·ª© m·ªánh', value: finalSum },
                { label: 'Li√™n k·∫øt', value: linkValue },
                { label: 'Linh h·ªìn', value: soulValue },
                { label: 'Tr∆∞·ªüng th√†nh', value: birthValue },
                { label: 'Nh√¢n c√°ch', value: personalityValue },
                { label: 'T∆∞ duy l√Ω tr√≠', value: logicalMind },
                { label: 'Ng√†y sinh', value: dayValue },
                { label: 'S·ª©c m·∫°nh ti·ªÅm th·ª©c', value: 9 - missingNumbers.length },
                { label: 'ƒêam m√™', value: passion },
                { label: 'NƒÉm c√° nh√¢n', value: personalYear },
                { label: 'Th√°ng c√° nh√¢n', value: personalMonth },
                { label: 'Th√°ch th·ª©c 1', value: challenge1 },
                { label: 'Th√°ch th·ª©c 2', value: challenge2 },
                { label: 'Th√°ch th·ª©c 3', value: challenge3 },
                { label: 'Th√°ch th·ª©c 4', value: challenge4 },
                { label: 'S·ªë thi·∫øu', value: missingNumbers.join(', ') },
                { label: 'Ch·∫∑ng 1', value: chang1 },
                { label: 'Ch·∫∑ng 2', value: chang2 },
                { label: 'Ch·∫∑ng 3', value: chang3 },
                { label: 'Ch·∫∑ng 4', value: chang4 }
            ];

            document.getElementById('result').innerHTML = results
                .map(item => `<div class="result-item"><strong>${item.label}:</strong> ${item.value}</div>`)
                .join('');
        }

        window.onload = () => {
            populateDateFields();
            populateBirthDateFields();
        };
    </script>
</body>
</html>
